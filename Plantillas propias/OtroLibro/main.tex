\documentclass[12pt,oneside]{book}
\usepackage[utf8]{inputenc}

%--------%
% IDIOMA %
%--------%
\usepackage[spanish,es-nodecimaldot,es-tabla,es-lcroman]{babel}

%--------%
% MARGEN %
%--------%
\usepackage[margin=1in,headheight=57pt,headsep=0.1in]{geometry}


%------------------------------%
% Carga del archivo matros.sty %
%------------------------------%
\usepackage{macros}


%----------------------%
% Paquetería adicional %
%----------------------%
\usepackage{standalone}
\usepackage{graphicx}
\usepackage{multicol}
\usepackage{microtype}
\usepackage{tikz}
\usepackage{comment}
\usepackage{pdfpages}
\usepackage{lipsum}

% -------------------------%
% ENCABEZADO/PIE DE PAGINA %
% -------------------------%
\usepackage{fancyhdr}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}
\fancyhead[R]{\slshape\nouppercase{\leftmark}}
\fancyhead[L]{\slshape\nouppercase{Materia}}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}

%--------------------%
% ESTILO DE CAPITULO %
%--------------------%
\usepackage{titlesec}    
\titleformat{\chapter}[display]
{\normalfont%
    \huge% 
    \bfseries}{\chaptertitlename\ \thechapter}{14pt}{%
    \Huge%
    }
\usepackage{sectsty}
\makeatletter
\def\@makechapterhead#1{%
  \vspace*{50\p@}%
  {\parindent \z@ \raggedright \normalfont
    \ifnum \c@secnumdepth >\m@ne
      \if@mainmatter
        %\huge\bfseries \@chapapp\space \thechapter
        \Huge\bfseries {\color{RobDarkBlue}{\thechapter}}.\space%
        %\par\nobreak
        %\vskip 20\p@
      \fi
    \fi
    \interlinepenalty\@M
    \Huge \bfseries {\color{RobDarkBlue}{#1}}\par\nobreak
    \vskip 40\p@
  }}
\makeatother
\chapterfont{\color{RobDarkBlue}}  % modificar color de capitulo

%----------%
% APENDICE %
%----------%
\usepackage{appendix}
\renewcommand{\appendixname}{Apéndices}
\renewcommand{\appendixpagename}{Apéndice}
\renewcommand{\appendixtocname}{Apéndice}

% ----------------- %
% AMBIENTES         %
% ----------------- %
%---------%
% Teorema %
%---------%
\newcounter{thm}[chapter]
\renewcommand{\thethm}{\thechapter.\arabic{thm}}
\newenvironment{thm}[1][]
 {%
  \refstepcounter{thm}%
  \mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[anchor=east,rectangle,fill=green!20]{\strut{Teorema~\thethm}\ifstrempty{#1}{}{~(\emph{#1})}};%
    },
    innertopmargin=10pt,
    linecolor=green!20,
    linewidth=3pt,
    topline=true,
    frametitleaboveskip=\dimexpr-\ht\strutbox\relax,
  }
  \begin{mdframed}
 }
 {\end{mdframed}}

%-------------%
% Observacion %
%-------------%
\newcounter{obs}[chapter]
\renewcommand{\theobs}{\thechapter.\arabic{obs}}
\newenvironment{obs}[1][]
 {%
  \refstepcounter{obs}%
  \mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[anchor=east,rectangle,fill=red!30]{\strut{Observación~\theobs}\ifstrempty{#1}{}{~(\emph{#1})}};%
    },
    innertopmargin=10pt,
    linecolor=red!30,
    linewidth=3pt,
    topline=true,
    frametitleaboveskip=\dimexpr-\ht\strutbox\relax,
  }
  \begin{mdframed}
 }
 {\end{mdframed}}

%------%
% Lema %
%------%
\newcounter{lema}[chapter]
\renewcommand{\thelema}{\thechapter.\arabic{lema}}
\newenvironment{lema}[1][]
 {%
  \refstepcounter{lema}%
  \mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[anchor=east,rectangle,fill=blue!30]{\strut{Lema~\thelema}\ifstrempty{#1}{}{~(\emph{#1})}};%
    },
    innertopmargin=10pt,
    linecolor=blue!30,
    linewidth=3pt,
    topline=true,
    frametitleaboveskip=\dimexpr-\ht\strutbox\relax,
  }
  \begin{mdframed}
 }
 {\end{mdframed}}

%------------%
% Definición %
%------------%
\newcounter{defn}[chapter]
\renewcommand{\thedefn}{\thechapter.\arabic{defn}}
\newenvironment{defn}[1][]
 {%
  \refstepcounter{defn}%
  \mdfsetup{%
    frametitle={%
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[anchor=east,rectangle,fill=violet!30]{\strut{Definición~\thedefn}\ifstrempty{#1}{}{~(\emph{#1})}};%
    },
    innertopmargin=10pt,
    linecolor=violet!30,
    linewidth=3pt,
    topline=true,
    frametitleaboveskip=\dimexpr-\ht\strutbox\relax,
  }
  \begin{mdframed}
 }
 {\end{mdframed}} 

%------------------------%
% AMBIENTES SIN CONTADOR %
%------------------------%
\newenvironment{question}[1][]{
\ifstrempty{#1}
    {}
    {\mdfsetup{
        frametitle={
            \tikz[baseline=(current bounding box.east),outer sep=0pt]
            \node[anchor=east,rectangle,fill=red!30]
            {Problema #1};}}
    }
    \mdfsetup{
        innertopmargin=10pt,linecolor=red!30,
        linewidth=2pt,topline=true,
        frametitleaboveskip=\dimexpr - \ht\strutbox\relax
    }
    \begin{mdframed}
}{
    \end{mdframed}
}
\newenvironment{lem}[1][]{
\ifstrempty{#1}
    {}
    {\mdfsetup{
        frametitle={
            \tikz[baseline=(current bounding box.east),outer sep=0pt]
            \node[anchor=east,rectangle,fill=orange!30]
            {Lema #1};}}
    }\newcommand{\coNP}{\ensuremath{\mathsf{coNP}}}

    % Commonly-used reductions add semantic clarity
    \newcommand{\CookReducesTo}{\ensuremath{\leq^P_T}}
    \newcommand{\KarpReducesTo}{\ensuremath{\leq^P_m}}
    \mdfsetup{
        innertopmargin=10pt,linecolor=orange!30,
        linewidth=2pt,topline=true,
        frametitleaboveskip=\dimexpr - \ht\strutbox\relax
    }
    \begin{mdframed}
}{
    \end{mdframed}
}

%---------%
% FUENTES %
%---------%
% Skip lines and don't indent
\setlength{\parindent}{0em}
\setlength{\parskip}{1em}

% FUENTES
\RequirePackage[bb=px, bbscaled=0.91,
  cal=txupr, calscaled=.91,
  frak=euler,frakscaled=.91,
  scr=boondoxupr]{mathalpha}
\let\amsmathbb\mathbb
\let\amsmathcal\mathcal
\let\amsmathfrak\mathfrak
\let\amsmathscr\mathscr
\AtBeginDocument{%
    \let\mathbb\relax
    \newcommand{\mathbb}[1]{\amsmathbb{#1}}
    \let\mathcal\relax
    \newcommand{\mathcal}[1]{\amsmathcal{#1}}
    \let\mathfrak\relax
    \newcommand{\mathfrak}[1]{\amsmathfrak{#1}}
    \let\mathscr\relax
    \newcommand{\mathscr}[1]{\amsmathscr{#1}}
}

\RequirePackage[osf]{mathpazo}
\author{Roberto Vásquez Martínez}

%----------%
% LISTADOS %
%----------%
% Los enlistados ahora tienen (i), (ii), ... en el primer nivel y (a), (b), ...
% en el segundo nivel
\usepackage[inline]{enumitem}
\setlist[1]{parsep=0pt,
topsep=3pt,
itemsep=0pt,
label=\textup{(\roman*)},
leftmargin=*}
\setlist[2]{parsep=0pt,
topsep=3pt,
itemsep=0pt,
label=\textup{(\alph*)}, 
leftmargin=*}
\usepackage{etoolbox}

%-----------------------%
% NUMERACION ECUACIONES %
%-----------------------%
\numberwithin{equation}{chapter}

%-------------------------------------%
% COLORES, REFERENCIAS, HIPERVINCULOS %
%-------------------------------------%
\definecolor{mytitlecolor}{RGB}{115,35,60}
\definecolor{mysectioncolor}{RGB}{104,34,139}
\definecolor{coolred}{HTML}{EC7990}
\usepackage[backend=biber,style=apa]{biblatex}
\usepackage{csquotes}
\DeclareLanguageMapping{spanish}{spanish-apa}
\urlstyle{same}
\addbibresource{demo.bib}

\hypersetup{
    colorlinks=true,
    linkcolor=RobRed,
    filecolor=magenta,      
    urlcolor=cyan,
    pdfauthor={R. Vasquez},
    pdftitle={Teorema de Donsker},
    citecolor=RobRed
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DOCUMENTO
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\input{portada}

\begingroup
\hypersetup{linkcolor=RobDarkBlue}
\tableofcontents
\endgroup

\addtocontents{toc}{\protect\thispagestyle{empty}} % quita numeracion del indice
\pagebreak
\setcounter{page}{1}

\include{caps/cap1}
\include{caps/cap2}
\include{caps/cap3}

\appendix
\include{appdx/appdx1}
\include{appdx/appdx2}

\nocite{*}
\printbibliography
\end{document}